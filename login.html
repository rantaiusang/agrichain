<script>
const SUPABASE_URL = 'https://nkcctncsjmcfsiguowms.supabase.co';
const SUPABASE_KEY = 'sb_publishable_CY2GLPbRJRDcRAyPXzOD4Q_63uR5W9X'; // PASTIKAN anon public

const supabaseClient = supabase.createClient(
    SUPABASE_URL,
    SUPABASE_KEY
);

const form = document.getElementById('loginForm');
const identifierInput = document.getElementById('identifier');
const passInput = document.getElementById('password');
const errorMsg = document.getElementById('errorMsg');

form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const identifier = identifierInput.value.trim();
    const password = passInput.value.trim();

    if (!identifier || !password) {
        errorMsg.textContent = "Lengkapi data login";
        errorMsg.style.display = "block";
        return;
    }

    try {
        // ADMIN LOGIN WAJIB EMAIL
        const { data, error } = await supabaseClient.auth.signInWithPassword({
            email: identifier,
            password: password
        });

        if (error) throw error;

        const { data: profile, error: profileError } = await supabaseClient
            .from('profiles')
            .select('role')
            .eq('id', data.user.id)
            .single();

        if (profileError) throw profileError;

        if (profile.role === 'ADMIN') {
            window.location.href = 'dashboard-admin.html';
        } else {
            window.location.href = 'index.html';
        }

    } catch (err) {
        console.error(err);
        errorMsg.textContent = err.message;
        errorMsg.style.display = "block";
    }
});
</script>
