<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Super Admin - AgriChain</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

<div id="logoutBtn" style="cursor:pointer;">ðŸšª Keluar</div>

<script>
/* =========================
   1. KONFIGURASI SUPABASE
========================= */
const SUPABASE_URL = 'https://nkcctncsjmcfsiguowms.supabase.co';
const SUPABASE_KEY = 'sb_publishable_CY2GLPbRJRDcRAyPXzOD4Q_63uR5W9X';

/* âœ… FIX: jangan menimpa object supabase */
const supabaseClient = supabase.createClient(
    SUPABASE_URL,
    SUPABASE_KEY
);

/* =========================
   2. CEK LOGIN & ROLE
========================= */
document.addEventListener("DOMContentLoaded", async () => {
    const { data: { session }, error } = await supabaseClient.auth.getSession();

    if (!session || error) {
        alert("Anda belum login");
        window.location.href = "login.html";
        return;
    }

    const { data: profile } = await supabaseClient
        .from("profiles")
        .select("role")
        .eq("id", session.user.id)
        .single();

    if (!profile || profile.role !== "ADMIN") {
        alert("Akses khusus Admin");
        window.location.href = "index.html";
        return;
    }

    console.log("âœ… Admin login");
});

/* =========================
   3. LOGOUT (FIX TOTAL)
========================= */
document.getElementById("logoutBtn").addEventListener("click", async () => {
    if (!confirm("Yakin ingin keluar?")) return;

    try {
        const { error } = await supabaseClient.auth.signOut();
        if (error) throw error;

        console.log("âœ… Logout sukses");
        window.location.href = "login.html";

    } catch (err) {
        console.error("Logout error:", err);
        alert("Logout gagal, paksa keluar.");
        window.location.href = "login.html";
    }
});
</script>

</body>
</html>
