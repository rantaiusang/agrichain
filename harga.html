<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harga Pasar - AgriChain</title>
    
    <!-- Library Blockchain -->
    <script src="https://unpkg.com/@web3modal/web3modal"></script>
    <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>

    <style>
        :root {
            --primary-green: #2E7D32;
            --light-green: #E8F5E9;
            --dark-green: #1B5E20;
            --text-dark: #333;
            --text-grey: #666;
            --white: #ffffff;
            --shadow: 0 2px 5px rgba(0,0,0,0.05);
            --radius: 8px;
        }

        body {
            font-family: "Segoe UI", Roboto, sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .card {
            background: var(--white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        h2 { margin-top: 0; color: var(--primary-green); }

        /* --- Harga Tabel --- */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: var(--light-green);
            color: var(--primary-green);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr:last-child td { border-bottom: none; }
        tr:hover { background-color: #fafafa; }

        .price-up { color: #f44336; font-weight: bold; } /* Merah */
        .price-down { color: #2E7D32; font-weight: bold; } /* Hijau */

        /* --- REKOMENDASI (ALGORITMA JUAL BELI) --- */
        .recommendation-section {
            background: #fff3e0; /* Kuning Muda */
            border-left: 5px solid #ff9800;
            padding: 15px;
            border-radius: var(--radius);
            margin-bottom: 20px;
        }

        .rec-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .rec-buy { background: #E8F5E9; color: #2E7D32; }
        .rec-sell { background: #FFEBEE; color: #C62828; }
        .rec-hold { background: #F3E5F5; color: #333; }

        .rec-text { font-size: 1.1rem; font-weight: 600; color: var(--text-dark); margin-bottom: 5px; }
        .rec-sub { font-size: 0.9rem; color: var(--text-grey); }

        /* --- SIMPLE TREND (CSS Bar Chart) --- */
        .trend-container {
            margin-top: 20px;
        }
        
        .trend-bar {
            margin-bottom: 10px;
        }
        .trend-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .trend-bg {
            width: 100%;
            background: #eee;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
        }
        .trend-fill {
            height: 100%;
            transition: width 1s;
        }
        .trend-up { background: #2E7D32; }
        .trend-down { background: #f44336; }

    </style>
</head>
<body>

    <div class="container">
        <!-- Header -->
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2>ðŸ“Š Info Harga Pasar</h2>
            <a href="index.html" style="color: #666; text-decoration: none; font-weight: bold;">&larr; Beranda</a>
        </div>

        <!-- Rekomendasi Berdasarkan Logika -->
        <div class="recommendation-section" id="recCard" style="display: none;">
            <span class="rec-badge" id="recBadge">ANALISIS</span>
            <div class="rec-text" id="recTitle">Analisa Harga...</div>
            <div class="rec-sub" id="recSubtitle">Sedang membandingkan dengan harga rata-rata pasar.</div>
        </div>

        <!-- Tabel Harga -->
        <div class="card">
            <h3>Harga Komoditas Hari Ini</h3>
            <table>
                <thead>
                    <tr>
                        <th>Komoditas</th>
                        <th>Harga Hari Ini (Rp)</th>
                        <th>Persentase Perubahan</th>
                    </tr>
                </thead>
                <tbody id="hargaBody">
                    <!-- Data akan dirender JS -->
                    <tr>
                        <td colspan="3" style="text-align: center; color: #999;">Memuat data pasar...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Grafik Tren Sederhana -->
        <div class="card">
            <h3>Tren Harga (Grafik Batang)</h3>
            <div class="trend-container" id="trendChart">
                <!-- Grafik akan dirender JS -->
            </div>
        </div>

    </div>

    <script type="module">
        // --- DATA DUMMY (MENSIMULASI SUPABASE) ---
        // Harga Rata-rata Pasar (Kita paksa set harga rata-rata manual)
        const hargaRataRata = {
            "Padi": 6000,
            "Jagung": 3500,
            "Gabah": 12000,
            "Sawit": 9000
        };

        // Data Harga Hari Ini (Simulasi API 'harga_pasar')
        const hargaHariIni = [
            { id: 1, nama: "Padi Cianjur", harga: 6500, rata: 6000, volume: 50 },
            { id: 2, nama: "Jagung Manis", harga: 3200, rata: 3500, volume: 120 },
            { id: 3, nama: "Gabah Rendang", harga: 13500, rata: 12000, volume: 30 },
            { id: 4, nama: "Sawit Mentah", harga: 8800, rata: 9000, volume: 90 }
        ];

        // --- DOM ELEMENTS ---
        const hargaBody = document.getElementById('hargaBody');
        const recCard = document.getElementById('recCard');
        const recBadge = document.getElementById('recBadge');
        const recTitle = document.getElementById('recTitle');
        const recSubtitle = document.getElementById('recSubtitle');
        const trendChart = document.getElementById('trendChart');

        // --- RENDER TABEL ---
        function renderTable() {
            hargaBody.innerHTML = '';

            hargaHariIni.forEach(item => {
                // Hitung persentase perubahan
                const persen = ((item.harga - item.rata) / item.rata) * 100;
                const isNaik = persen > 0;

                const persenText = (isNaik ? "+" : "") + persen.toFixed(1) + "%";
                const kelasWarna = isNaik ? "price-up" : "price-down";

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${item.nama}</strong></td>
                    <td style="font-weight: bold;">Rp ${item.harga.toLocaleString('id-ID')}</td>
                    <td class="${kelasWarna}">${persenText}</td>
                `;
                hargaBody.appendChild(row);
            });
        }

        // --- RENDER TREN SEDERHANA (CSS BAR CHART) ---
        function renderTrend() {
            let htmlContent = '';

            // Kita tampilkan top 2 harga tertinggi untuk grafik
            const topItems = [...hargaHariIni].sort((a,b) => b.harga - a.harga).slice(0, 2);
            const maxPrice = topItems[0].harga;

            topItems.forEach(item => {
                const percentage = (item.harga / maxPrice) * 100;
                const isNaik = (item.harga > item.rata);
                const warnaBar = isNaik ? "trend-up" : "trend-down";

                htmlContent += `
                    <div class="trend-bar">
                        <div class="trend-label">
                            <span>${item.nama}</span>
                            <span>Rp ${item.harga.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="trend-bg">
                            <div class="trend-fill ${warnaBar}" style="width: ${percentage}%;"></div>
                        </div>
                    </div>
                `;
            });

            trendChart.innerHTML = htmlContent;
        }

        // --- LOGIKA REKOMENDASI (JUAL / BELI) ---
        function analisaRekomendasi() {
            // Logika Sederhana:
            // 1. Cek ada komoditas yang harga di bawah rata-rata (Rekomendasi: BELI)
            // 2. Cek ada komoditas yang harga di atas rata-rata (Rekomendasi: JUAL)
            
            const barangMurah = hargaHariIni.find(h => h.harga < h.rata);
            const barangMahal = hargaHariIni.find(h => h.harga > h.rata);

            recCard.style.display = 'block'; // Tampilkan kotak rekomendasi

            if (barangMurah && barangMahal) {
                recBadge.className = "rec-badge rec-buy";
                recBadge.textContent = "SARAN: BELI";
                recTitle.textContent = `Harga ${barangMurah.nama} MURAH!`;
                recSubtitle.textContent = "Stok cukup di pasar. Waktunya membeli bibit untuk tanam.";
            } else if (barangMahal && !barangMurah) {
                recBadge.className = "rec-badge rec-sell";
                recBadge.textContent = "SARAN: JUAL";
                recTitle.textContent = `Harga ${barangMahal.nama} TINGGI!`;
                recSubtitle.textContent = "Permintaan pasar meningkat. Waktunya menjual hasil panen Anda.";
            } else {
                recBadge.className = "rec-badge rec-hold";
                recBadge.textContent = "NETRAL";
                recTitle.textContent = "Harga Pasar Stabil";
                recSubtitle.textContent = "Tidak ada perubahan signifikan. Simpan stok dulu.";
            }
        }

        // --- INISIALISASI ---
        document.addEventListener("DOMContentLoaded", () => {
            renderTable();
            renderTrend();
            analisaRekomendasi();
        });

    </script>
</body>
</html>
