<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pasar Belanja - AgriChain</title>
    <style>
        :root {
            --primary-green: #2E7D32;
            --light-green: #E8F5E9;
            --accent-green: #4CAF50;
            --text-dark: #1B1B1B;
            --text-grey: #666;
            --white: #ffffff;
            --gold: #FFC107;
            --bg-gray: #F5F5F5;
            --radius: 12px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-gray);
            margin: 0;
            padding-bottom: 80px;
            color: var(--text-dark);
        }

        /* Header */
        header {
            background: var(--primary-green);
            color: white;
            padding: 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-title {
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-badge {
            font-size: 0.8rem;
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* Filter Section */
        .filter-container {
            background: white;
            padding: 12px 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: sticky;
            top: 60px; /* Di bawah header */
            z-index: 90;
        }

        .filter-row {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
            min-width: 120px;
        }

        /* Product List */
        .container {
            padding: 16px;
            max-width: 600px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 16px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.06);
            border: 1px solid transparent;
            transition: transform 0.2s;
        }

        .card:active {
            transform: scale(0.98);
        }

        .card-img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            background-color: #eee;
        }

        .card-body {
            padding: 14px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .product-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin: 0;
        }

        .location-tag {
            font-size: 0.75rem;
            color: var(--text-grey);
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 8px;
        }

        /* Trust Score Styling */
        .trust-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .trust-high {
            background-color: #FFF8E1;
            color: #FF8F00;
            border: 1px solid #FFECB3;
        }

        .trust-mid {
            background-color: #E8F5E9;
            color: #2E7D32;
            border: 1px solid #C8E6C9;
        }

        .trust-low {
            background-color: #FFEBEE;
            color: #C62828;
            border: 1px solid #FFCDD2;
        }

        .price-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px dashed #eee;
        }

        .price {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--primary-green);
        }

        .btn-buy {
            background: var(--primary-green);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .seller-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .seller-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ddd;
        }

        .seller-name {
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 200;
        }
        .toast.show { opacity: 1; }

    </style>
</head>
<body>

    <header>
        <div class="header-title">
            <span>AgriChain Belanja</span>
            <span class="user-badge">Buyer</span>
        </div>
    </header>

    <!-- Filter Panel -->
    <div class="filter-container">
        <div class="filter-row">
            <select id="filterLocation" class="filter-select" onchange="applyFilters()">
                <option value="all">Semua Lokasi</option>
                <option value="Jawa Barat">Jawa Barat</option>
                <option value="Jawa Tengah">Jawa Tengah</option>
                <option value="Jawa Timur">Jawa Timur</option>
                <option value="Sumatera">Sumatera</option>
            </select>

            <select id="filterType" class="filter-select" onchange="applyFilters()">
                <option value="all">Semua Komoditas</option>
                <option value="padi">Padi & Beras</option>
                <option value="jagung">Jagung</option>
                <option value="kopi">Kopi</option>
                <option value="cabai">Cabai</option>
            </select>

            <select id="filterTrust" class="filter-select" onchange="applyFilters()">
                <option value="all">Semua Skor</option>
                <option value="high">Hanya Bintang 4+ (Terpercaya)</option>
                <option value="mid">Bintang 3+ (Baik)</option>
            </select>
        </div>
    </div>

    <!-- Daftar Produk -->
    <main class="container" id="productList">
        <!-- Konten akan diisi oleh JavaScript -->
    </main>

    <div id="toast" class="toast">Menghubungi Petani...</div>

    <script>
        // Data Dummy Simulasi Database
        const products = [
            {
                id: 1,
                name: "Padi IR64 Organik",
                type: "padi",
                location: "Jawa Barat",
                price: 6500,
                unit: "kg",
                seller: "Pak Budi Santoso",
                trustScore: 4.8, // Skor Tinggi
                transactions: 52,
                img: "https://picsum.photos/seed/padi1/400/200"
            },
            {
                id: 2,
                name: "Jagung Manis Kualitas Super",
                type: "jagung",
                location: "Jawa Timur",
                price: 4000,
                unit: "kg",
                seller: "Bu Siti Aminah",
                trustScore: 3.5, // Skor Menengah
                transactions: 12,
                img: "https://picsum.photos/seed/jagung1/400/200"
            },
            {
                id: 3,
                name: "Kopi Arabika Gayo",
                type: "kopi",
                location: "Sumatera",
                price: 85000,
                unit: "kg",
                seller: "Koperasi Kopi Gayo",
                trustScore: 5.0, // Skor Sempurna
                transactions: 120,
                img: "https://picsum.photos/seed/kopi1/400/200"
            },
            {
                id: 4,
                name: "Cabai Merah Keriting",
                type: "cabai",
                location: "Jawa Tengah",
                price: 32000,
                unit: "kg",
                seller: "Pak Yono",
                trustScore: 2.8, // Skor Rendah (Perlu Hati-hati)
                transactions: 5,
                img: "https://picsum.photos/seed/cabai1/400/200"
            },
            {
                id: 5,
                name: "Padi Mentik Wangi",
                type: "padi",
                location: "Jawa Tengah",
                price: 9000,
                unit: "kg",
                seller: "Kelompok Tani Makmur",
                trustScore: 4.2,
                transactions: 30,
                img: "https://picsum.photos/seed/padi2/400/200"
            }
        ];

        // Format Rupiah
        const formatRupiah = (number) => {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);
        };

        // Fungsi Menentukan Warna Badge Skor
        const getTrustBadge = (score) => {
            if (score >= 4.0) return `<span class="trust-badge trust-high">‚òÖ ${score} MITRA UTAMA</span>`;
            if (score >= 3.0) return `<span class="trust-badge trust-mid">‚òÖ ${score} BAIK</span>`;
            return `<span class="trust-badge trust-low">‚òÖ ${score} AWAS</span>`;
        };

        // Fungsi Render Produk
        function renderProducts(list) {
            const container = document.getElementById('productList');
            container.innerHTML = '';

            if (list.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:20px; color:#888;">Tidak ada panen yang cocok dengan filter.</div>';
                return;
            }

            list.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                
                card.innerHTML = `
                    <img src="${item.img}" alt="${item.name}" class="card-img">
                    <div class="card-body">
                        <div class="seller-info">
                            <div class="seller-avatar"></div>
                            <div>
                                <div class="seller-name">${item.seller}</div>
                                <div class="location-tag">üìç ${item.location}</div>
                            </div>
                            <div style="margin-left:auto;">
                                ${getTrustBadge(item.trustScore)}
                            </div>
                        </div>

                        <h3 class="product-title">${item.name}</h3>
                        
                        <div class="price-section">
                            <div class="price">${formatRupiah(item.price)} / ${item.unit}</div>
                            <button class="btn-buy" onclick="contactSeller('${item.seller}')">Beli</button>
                        </div>
                        
                        <div style="font-size:0.75rem; color:#888; margin-top:5px; text-align:right;">
                            ${item.transactions}x Transaksi Sukses
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Fungsi Filter
        function applyFilters() {
            const locVal = document.getElementById('filterLocation').value;
            const typeVal = document.getElementById('filterType').value;
            const trustVal = document.getElementById('filterTrust').value;

            const filtered = products.filter(item => {
                const matchLoc = locVal === 'all' || item.location === locVal;
                const matchType = typeVal === 'all' || item.type === typeVal;
                
                let matchTrust = true;
                if (trustVal === 'high') matchTrust = item.trustScore >= 4.0;
                if (trustVal === 'mid') matchTrust = item.trustScore >= 3.0;

                return matchLoc && matchType && matchTrust;
            });

            renderProducts(filtered);
        }

        // Simulasi Kontak (Buyer hanya bisa liat & hubungi, tidak bisa edit)
        function contactSeller(sellerName) {
            const toast = document.getElementById('toast');
            toast.textContent = `Membuka chat dengan ${sellerName}...`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
                // Di real app: window.location.href = `chat.html?id=...`
            }, 2000);
        }

        // Init
        renderProducts(products);

    </script>
</body>
</html>
