<script>
/* =========================
   1. KONFIGURASI SUPABASE
========================= */
const SUPABASE_URL = 'https://nkcctncsjmcfsiguowms.supabase.co';
const SUPABASE_KEY = 'sb_publishable_CY2GLPbRJRDcRAyPXzOD4Q_63uR5W9X';

const supabaseClient = supabase.createClient(
    SUPABASE_URL,
    SUPABASE_KEY
);

/* =========================
   2. DOM READY (WAJIB)
========================= */
document.addEventListener("DOMContentLoaded", async () => {

    /* === LOGOUT BUTTON FIX === */
    const logoutBtn = document.getElementById("logoutBtn");

    if (!logoutBtn) {
        console.error("âŒ Tombol logout tidak ditemukan");
        return;
    }

    logoutBtn.addEventListener("click", async () => {
        console.log("ðŸ”´ Logout diklik");

        if (!confirm("Keluar dari Admin?")) return;

        try {
            const { error } = await supabaseClient.auth.signOut();
            if (error) throw error;

            console.log("âœ… Logout berhasil");
            window.location.href = "login.html";

        } catch (err) {
            console.error("Logout error:", err);
            alert("Logout gagal, dialihkan paksa.");
            window.location.href = "login.html";
        }
    });

    /* === CEK SESSION === */
    const { data: { session }, error } =
        await supabaseClient.auth.getSession();

    if (!session || error) {
        alert("Anda belum login");
        window.location.href = "login.html";
        return;
    }

    /* === CEK ROLE === */
    const { data: profile } = await supabaseClient
        .from("profiles")
        .select("role")
        .eq("id", session.user.id)
        .single();

    if (!profile || profile.role !== "ADMIN") {
        alert("Akses Admin saja");
        window.location.href = "index.html";
        return;
    }

    console.log("âœ… Admin terverifikasi");

    loadCommodities();
    loadStats();
});

/* =========================
   FUNGSI LAIN TIDAK DIUBAH
========================= */
</script>
